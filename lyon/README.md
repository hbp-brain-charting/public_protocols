# Lyon battery

This file contains information on the required software to run the tasks and get
logfiles to use for posterior analysis, as well as instructions and clarifications
about the naming conventions, software and file structure used by us.

## Table of contents
1. [Presentation Software](#Presentation Software)
2. [How to run the tasks](#How to run the tasks)
3. [How to get logfiles from the tasks](#How to get logfiles from the tasks)
4. [Where can I find X in the code? (Adjustments help)](#Where can I find X in the code?)

## Presentation Software
To run these tasks, you will need to install Presentation ([Neurobehavioral Systems](https://www.neurobs.com/)).
You will also need to acquire a license to use the software, which can be purchased in the same webpage.

## How to run the tasks
Once you have opened Presentation, click on "Open experiment", in the "Experiment" tab. Then, navigate to the folder of the
experiment you want to run (./protocols/session_[n]/[experiment]) and open the .exp file inside. Next, click on
the big "Run" button in the middle.

A prompt will appear asking for the participant ID. The naming structure we used (which is required by the rest
of the software that deals with the logfiles) is the following:

    sub-[sub_num]_[run-num]
    
sub_num can be any number between 1 and 99, and in our case, the run-number was either 1 or 2, since we acquired 
data twice for all protocols. Presentaiton will then take care of appending the name of the task to this string.
After this, the "Status" window will appear. Here you have two relevant pieces of information.

* The windows at the top-left corner contains the scenarios (runs). We have run two scenarios per experiment, and
both use the same stimuli, but in different order. Importantly, we run all tasks' first run (first scenario), and 
then all tasks' second run (second scenario). So, if you do the same, you have to make sure that you click on the
correct scenario in this window.

* The "Run scenario" button will run the scenario you have currently selected, defaulting at the top of the list.

After clicking on it, the experiment will start. You will then see a red fixation cross, indicative that the protocol
is waiting for the scanner's first pulse, which was mapped to the 'T' letter in the keyboard.

After running the experiment, you can close the Status window and repeat the process with the next protocol.

It is also important to note that each session folder contains also a "training_session" folder. This folder contains
shorter versions of all protocols, which we presented to the participant directly in the presentation computer, before
the scanning session.

The keys for all experiments are configured for 'y' for the index finger and 'g' for the major finger, followind the
keyboard mapping of our five-button response box. The only exception is the 'moto' task, for which we two one-button
responce devices, one in each hand. The 'y' key is assigned to the left hand and the 'b' key to the right hand.

## How to get logfiles from the tasks

Once you have run the protocols, the logfiles generated by Presentation will be stored in each protocol's 'logfiles'
folder. If you want to change the default logfile folder, please check [How to change the logfile default folder](#How to change the logfile default folder).

To generate handsome BIDS-compliant .tsv files, navigate to paradigm_descriptors/paradigm_descriptors_extraction and 
execute paradigm_descriptors_extraction.py as follows:

    $ python paradigm_descriptors_extraction.py [sub_type] [sub_num] [ses-num]
    
* sub-type can be either 0 or 1:

    * 0 is for 'MRI-pilot', 1 is for 'sub'

* sub-num must be an integer from 1 to 99
* ses-num corresponds to the number of the session

After running the script, you can find your logfiles in paradigm_descriptors/paradigm_descriptors_logfiles under each task's
particular folder.

## Where can I find X in the code?

### How to change the logfile default folder

Once you open an experiment in presentation, you can navigate to the 'Scenarios' tab and there you will see a field that 
contains the path to the logfile folder. You can change this path to where you want your logfiles to be stored.

The path must be also changed in the paradigm_descriptors_extraction.py script, located in line 106.
